<!-- lunch_time/views/hr_attendance_views.xml -->
<odoo>
    <data>
        <!-- Define the action for the new menu -->
        <record id="action_lunch_time_web_button" model="ir.actions.server">
            <field name="name">Go to Web Page</field>
            <field name="model_id" ref="hr_attendance.model_hr_attendance"/>
            <field name="binding_model_id" ref="hr_attendance.model_hr_attendance"/>
            <field name="state">code</field>
            <field name="code">
                action = {
                    'type': 'ir.actions.act_url',
                    'url': '/lunch_time/page',
                    'target': 'self',
                }
            </field>
        </record>

<!-- Template for the web page -->
<template id="attendance_page" name="Attendance Page">
    <t t-call="web.html_container">
        <t t-set="title">Comedor</t>
        <t t-call-assets="web.assets_frontend"/>
        <!--<link rel="stylesheet" type="text/css" href="/lunch_time/static/src/css/attendance.css"/>-->
        <body>
            <h4 style="color: white;">
                <div style="background-color: transparent;">
                    <span id="current-time">Cargando hora...</span>
                </div>
            </h4>
            <center><h1 style="color: white;">Comedor</h1></center>
            <a href="https://exellquim-odoosistema-20240709-14115142.dev.odoo.com/web#cids=1&amp;action=830&amp;menu_id=591" style="position: absolute; top: 10px; right: 10px; color: white; font-size: 24px; text-decoration: none;">
                <i class="fa fa-window-close" aria-hidden="true"></i>
            </a>
            <div style="background-color: #C08EC2; color: black; width: 40%; height: 320px; margin-top: 50px; margin-left: 0px; position: relative;">
                <!-- Botón de cerrar -->
                
                <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%; background-color: transparent;">

                    <!-- Icono de código de barras con línea roja -->
                    <i class="fa fa-barcode" style="font-size: 68px; margin-bottom: 0px; position: relative;"></i>

                    <!-- Contenido centrado -->
                    <h3 style="color: white;">Escanea tu credencial</h3>
                    <form id="scan-form" action="/lunch_time/submit" method="post" style="text-align: center;">
                        <div class="form-group">
                            <input type="text" name="barcode" id="barcode-input" placeholder="Ingresa tu credencial" />
                        </div>
                        <button type="submit" class="btn d-none">Enviar</button>
                    </form>
                    
                    <!-- Manejo de errores -->
                    <t t-if="error">
                        <p class="text-danger"><t t-esc="error"/></p>
                    </t>
                </div>
            </div>
        
        </body>
        <script type="text/javascript">
            // Función para enfocar automáticamente el input al cargar la página
            document.addEventListener('DOMContentLoaded', function() {
                document.getElementById('barcode-input').focus();
            });

            // Función para obtener y mostrar la hora actual
            function displayCurrentTime() {
                var now = new Date();
                var hours = now.getHours().toString().padStart(2, '0');
                var minutes = now.getMinutes().toString().padStart(2, '0');
                var seconds = now.getSeconds().toString().padStart(2, '0');
                var currentTime = hours + ':' + minutes + ':' + seconds;
                document.getElementById('current-time').textContent = 'Hora actual: ' + currentTime;
            }

            // Llama a la función inicialmente para mostrar la hora actual
            displayCurrentTime();

            // Actualiza la hora cada segundo
            setInterval(displayCurrentTime, 1000);

            // Maneja el envío del formulario al presionar Enter en el input de barcode
            document.getElementById('barcode-input').addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    document.getElementById('scan-form').submit();
                }
            });
        </script>
    </t>
</template>


<!-- Template for the web page -->
<template id="confirmation_page" name="Confirmation Page">
    <t t-call="web.html_container">
        <t t-set="title">Confirmación de Registro</t>
        <body class="oe_structure" style="background-image: url('/lunch_time/static/img/fondo.png'); background-size: cover; background-position: center; background-repeat: no-repeat;">
            <section class="s_text_block">
                <div class="container">
                    <div class="row">
                        <!-- Columna izquierda para la imagen del empleado y título -->
                         <div style="background-color: #C08EC2; color: black; width: 40%; height: 320px;  margin-left: 0px; margin-top: 170px;">
                    <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%;">
                        <div class="col-6 text-center">
                            <div style="position: relative; display: inline-block; margin-top: 50px;">
                                <!-- Imagen predeterminada del usuario en un círculo con borde blanco -->
                                <div style="position: relative; display: inline-block;">
                                    <img src="/lunch_time/static/img/usuario.png" style="border-radius: 80%; width: 150px; height: 150px; object-fit: cover; border: 3px solid white;" />
                                </div>
                                <!-- Círculo encima de la imagen para la miniatura -->
                                <div style="position: absolute; top: -15px; left: calc(50% + 70px); background-color: white; border: 3px solid #C08EC2; width: 36px; height: 36px; border-radius: 50%; display: flex; justify-content: center; align-items: center;">
          
                                </div>
                            </div>
                            <!-- Nombre del empleado -->
                            <h3 style="color: white; margin-top: 20px;"><t t-esc="employee_name"/></h3>
                            <!-- Hora actual -->
                            <p style="color: white;"><t t-esc="current_time"/></p>
                        </div>
                        </div>
                        </div>
                        
                        <!-- Columna derecha para el mensaje -->
                        <div class="col-6 text-center">
                            <h1 style="color: white; margin-top: 50px;"><t t-esc="message"/></h1>
                        </div>
                    </div>
                </div>
            </section>
        </body>
        <script type="text/javascript">
            // Redireccionamiento después de 4 segundos
            setTimeout(function(){
                window.location.href = "/lunch_time/page";
            }, 3000);
        </script>
    </t>
</template>



        <!-- Define a new menu item -->
        <record id="menu_lunch_time_web" model="ir.ui.menu">
            <field name="name">Quiosco Comida</field>
            <field name="parent_id" ref="hr_attendance.menu_hr_attendance_root"/>
            <field name="action" ref="action_lunch_time_web_button"/>
            <field name="sequence" eval="10"/>
        </record>
    </data>
</odoo>

